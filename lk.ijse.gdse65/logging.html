<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign in || Sign up from</title>
    <!-- font awesome icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- css stylesheet -->
    <link rel="stylesheet" href="design/css/logging.css">
</head>
<body>

<div class="container" id="container">
    <div class="form-container sign-up-container">
        <form action="#">
            <h1>Create Account</h1>
            <div class="social-container">
                <a href="#" class="social"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="social"><i class="fab fa-google-plus-g"></i></a>
                <a href="#" class="social"><i class="fab fa-linkedin-in"></i></a>
            </div>
            <span>or use your email for registration</span>
            <div class="infield">
                <input type="text" placeholder="Name" id="nameInput" />
                <label></label>
            </div>
            <div class="infield">
                <input type="email" placeholder="Email" id="emailInput" name="email"/>
                <label></label>
            </div>
            <div class="infield">
                <input type="password" placeholder="Password" id="passwordInput" />
                <label></label>
            </div>
            <div class="infield">
                <input type="text" placeholder="Role" id="roleInput" />
                <label></label>
            </div>
            <button id="signUpBtn">Sign Up</button>
        </form>
    </div>
    <div class="form-container sign-in-container">
        <form action="#">
            <h1>Sign in</h1>
            <div class="social-container">
                <a href="#" class="social"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="social"><i class="fab fa-google-plus-g"></i></a>
                <a href="#" class="social"><i class="fab fa-linkedin-in"></i></a>
            </div>
            <span>or use your account</span>
            <div class="infield">
                <input type="email" id="emailLogin" placeholder="Email" name="email"/>
                <label></label>
            </div>
            <div class="infield">
                <input type="password" id="passwordLogin" placeholder="Password" />
                <label></label>
            </div>
            <a href="#" class="forgot">Forgot your password?</a>
            <button id="signInBtn">Sign In</button>
        </form>
    </div>
    <div class="overlay-container" id="overlayCon">
        <div class="overlay">
            <div class="overlay-panel overlay-left">
                <h1>Welcome Back!</h1>
                <p>To keep connected with us please logging  with your personal info</p>
                <button>Sign In</button>
            </div>
            <div class="overlay-panel overlay-right">
                <h1>Hello, Friend!</h1>
                <p>Enter your personal details and start journey with us</p>
                <button>Sign Up</button>
            </div>
        </div>
        <button id="overlayBtn"></button>
    </div>
</div>


<!-- js code -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const container = document.getElementById("container");
        const overlayBtn = document.getElementById("overlayBtn");

        overlayBtn.addEventListener('click', () => {
            container.classList.toggle("right-panel-active");
            overlayBtn.classList.remove('btnScaled');
            window.requestAnimationFrame(() => {
                overlayBtn.classList.add('btnScaled');
            });
        });
    });

    //     function setTokenExpiry(accessToken) {
    //         const tokenPayload = JSON.parse(atob(accessToken.split('.')[1]));
    //         const expiryTime = tokenPayload.exp * 1000;
    //         localStorage.setItem("tokenExpiryTime", expiryTime);
    //     }
    //
    //     function isTokenExpired() {
    //         const expiryTime = localStorage.getItem("tokenExpiryTime");
    //         return new Date().getTime() > expiryTime;
    //     }
    //
    //     function refreshToken() {
    //         const refreshToken = localStorage.getItem("refreshToken");
    //         if (!refreshToken) {
    //             return;
    //         }
    //
    //         var xhr = new XMLHttpRequest();
    //         xhr.open("POST", "http://localhost:8081/shop/api/v1/auth/refresh", true);
    //         xhr.setRequestHeader("Content-Type", "application/json");
    //         xhr.onreadystatechange = function () {
    //             if (xhr.readyState === 4 && xhr.status === 200) {
    //                 var response = JSON.parse(xhr.responseText);
    //                 var accessToken = response.token.split(':')[0].trim();
    //                 var newRefreshToken = response.token.split(':')[1].trim();
    //                 localStorage.setItem("accessToken", accessToken);
    //                 localStorage.setItem("refreshToken", newRefreshToken);
    //                 setTokenExpiry(accessToken);
    //                 console.log("Access Token refreshed:", accessToken);
    //             } else if (xhr.readyState === 4) {
    //                 console.error("Token refresh failed. Status:", xhr.status);
    //                 // Optionally, you can redirect the user to the login page or show a message
    //                 // window.location.href = "login.html";
    //             }
    //         };
    //         var data = JSON.stringify({
    //             "refreshToken": refreshToken
    //         });
    //         xhr.send(data);
    //     }
    //
    //     const accessToken = localStorage.getItem("accessToken");
    //     // const refreshToken = localStorage.getItem("refreshToken");
    //
    //     if (accessToken) {
    //         if (isTokenExpired()) {
    //             refreshToken();
    //         } else {
    //             // Redirect to the main page if the user is already logged in
    //             window.location.href = "index.html";
    //         }
    //     }
    //     refreshToken();
    //     document.getElementById("signUpBtn").addEventListener("click", function() {
    //         var name = document.getElementById("nameInput").value;
    //         var email = document.getElementById("emailInput").value;
    //         var password = document.getElementById("passwordInput").value;
    //         var role = document.getElementById("roleInput").value;
    //
    //         var xhr = new XMLHttpRequest();
    //         xhr.open("POST", "http://localhost:8081/shop/api/v1/auth/signup", true);
    //         xhr.setRequestHeader("Content-Type", "application/json");
    //         xhr.onreadystatechange = function () {
    //             if (xhr.readyState === 4 && xhr.status === 200) {
    //                 var response = JSON.parse(xhr.responseText);
    //                 var accessToken = response.token.split(':')[0].trim();
    //                 var refreshToken = response.token.split(':')[1].trim();
    //                 localStorage.setItem("accessToken", accessToken);
    //                 localStorage.setItem("refreshToken", refreshToken);
    //                 setTokenExpiry(accessToken);
    //                 console.log("Access Token:", accessToken);
    //                 console.log("Refresh Token:", refreshToken);
    //                 // Redirect after signup if needed
    //                 if (localStorage.getItem("accessToken")) {
    //                     window.location.href = "index.html";
    //                 }
    //             }
    //         };
    //         var data = JSON.stringify({
    //
    //             "name": name,
    //             "email": email,
    //             "password": password,
    //             "role": role
    //         });
    //         xhr.send(data);
    //     });
    //
    //     document.getElementById("signInBtn").addEventListener("click", function() {
    //         refreshToken();
    //         var email = document.getElementById("emailLogin").value;
    //         var password = document.getElementById("passwordLogin").value;
    //
    //         var xhr = new XMLHttpRequest();
    //         xhr.open("POST", "http://localhost:8081/shop/api/v1/auth/signin", true);
    //         xhr.setRequestHeader("Content-Type", "application/json");
    //         xhr.onreadystatechange = function () {
    //             if (xhr.readyState === 4) {
    //                 if (xhr.status === 200) {
    //                     var response = JSON.parse(xhr.responseText);
    //                     var accessToken = response.token.split(':')[0].trim();
    //                     var refreshToken = response.token.split(':')[1].trim();
    //                     localStorage.setItem("accessToken", accessToken);
    //                     localStorage.setItem("refreshToken", refreshToken);
    //                     setTokenExpiry(accessToken);
    //                     console.log("Access Token:", accessToken);
    //                     console.log("Refresh Token:", refreshToken);
    //
    //                     // Redirect to another page if the access token is successfully stored
    //                     if (localStorage.getItem("accessToken")) {
    //                         window.location.href = "index.html";  // Change this to your desired page
    //                     }
    //                 } else {
    //                     // Handle unsuccessful sign-in, e.g., display an error message
    //                     console.error("Sign In failed. Status:", xhr.status);
    //                 }
    //             }
    //         };
    //         var data = JSON.stringify({
    //             "email": email,
    //             "password": password
    //         });
    //         xhr.send(data);
    //     });
    //
    //     // Call refreshToken function periodically (e.g., every 15 minutes)
    //     setInterval(function() {
    //         if (isTokenExpired()) {
    //             refreshToken();
    //         }
    //     }, 15 * 60 * 1000); // 15 minutes
    // });

// ****************************************************************
    // const  container = document.getElementById("container")
    // const  overlayCon = document.getElementById("overlayCon")
    // const  overlayBtn = document.getElementById("overlayBtn")
    //
    // overlayBtn.addEventListener('click',()=> {
    //     container.classList.toggle(("right-panel-active"));
    //
    //     overlayBtn.classList.remove('btnScaled');
    //     window.requestAnimationFrame(()=>{
    //         overlayBtn.classList.add('btnScaled')
    //     })
    //
    // })
    //
    //
    // document.getElementById("signUpBtn").addEventListener("click", function() {
    //     var name = document.getElementById("nameInput").value;
    //     var email = document.getElementById("emailInput").value;
    //     var password = document.getElementById("passwordInput").value;
    //     var role = document.getElementById("roleInput").value;
    //
    //     var xhr = new XMLHttpRequest();
    //     xhr.open("POST", "http://localhost:8080/shop/api/v1/auth/signup", true);
    //     xhr.setRequestHeader("Content-Type", "application/json");
    //     xhr.onreadystatechange = function () {
    //         if (xhr.readyState === 4 && xhr.status === 200) {
    //             var response = JSON.parse(xhr.responseText);
    //             var accessToken = response.token.split(':')[0].trim();
    //             var refreshToken = response.token.split(':')[1].trim();
    //             localStorage.setItem("accessToken", accessToken);
    //             localStorage.setItem("refreshToken", refreshToken);
    //             console.log("Access Token:", accessToken);
    //             console.log("Refresh Token:", refreshToken);
    //             // You can do something with the tokens here, such as redirecting to another page
    //         }
    //     };
    //     var data = JSON.stringify({
    //         "name": name,
    //         "email": email,
    //         "password": password,
    //         "role": role
    //     });
    //     xhr.send(data);
    // });
    //
    //
    // document.getElementById("signInBtn").addEventListener("click", function() {
    //     var email = document.getElementById("emailLogin").value;
    //     var password = document.getElementById("passwordLogin").value;
    //
    //     var xhr = new XMLHttpRequest();
    //     xhr.open("POST", "http://localhost:8080/shop/api/v1/auth/signin", true);
    //     xhr.setRequestHeader("Content-Type", "application/json");
    //     xhr.onreadystatechange = function () {
    //         if (xhr.readyState === 4) {
    //             if (xhr.status === 200) {
    //                 var response = JSON.parse(xhr.responseText);
    //                 var accessToken = response.token.split(':')[0].trim();
    //                 var refreshToken = response.token.split(':')[1].trim();
    //                 localStorage.setItem("accessToken", accessToken);
    //                 localStorage.setItem("refreshToken", refreshToken);
    //                 console.log("Access Token:", accessToken);
    //                 console.log("Refresh Token:", refreshToken);
    //
    //                 // Redirect to another page if the access token is successfully stored
    //                 if (localStorage.getItem("accessToken")) {
    //                     window.location.href = "index.html";  // Change this to your desired page
    //                 }
    //             } else {
    //                 // Handle unsuccessful sign-in, e.g., display an error message
    //                 console.error("Sign In failed. Status:", xhr.status);
    //             }
    //         }
    //     };
    //     var data = JSON.stringify({
    //         "email": email,
    //         "password": password
    //     });
    //     xhr.send(data);
    // });

    // document.getElementById("signInBtn").addEventListener("click", function() {
    //     var email = document.getElementById("emailLogin").value;
    //     var password = document.getElementById("passwordLogin").value;
    //
    //     var xhr = new XMLHttpRequest();
    //     xhr.open("POST", "http://localhost:8080/shop/api/v1/auth/signin", true);
    //     xhr.setRequestHeader("Content-Type", "application/json");
    //     xhr.onreadystatechange = function () {
    //         if (xhr.readyState === 4) {
    //             if (xhr.status === 200) {
    //                 var response = JSON.parse(xhr.responseText);
    //                 var accessToken = response.token.split(':')[0].trim();
    //                 var refreshToken = response.token.split(':')[1].trim();
    //                 localStorage.setItem("accessToken", accessToken);
    //                 localStorage.setItem("refreshToken", refreshToken);
    //                 console.log("Access Token:", accessToken);
    //                 console.log("Refresh Token:", refreshToken);
    //                 // You can do something with the tokens here, such as redirecting to another page
    //             } else {
    //                 // Handle unsuccessful sign-in, e.g., display an error message
    //                 console.error("Sign In failed. Status:", xhr.status);
    //             }
    //         }
    //     };
    //     var data = JSON.stringify({
    //         "email": email,
    //         "password": password
    //     });
    //     xhr.send(data);
    // });
</script>
<script>
    function setTokenExpiry(accessToken) {
        const tokenPayload = JSON.parse(atob(accessToken.split('.')[1]));
        const expiryTime = tokenPayload.exp * 1000;
        localStorage.setItem("tokenExpiryTime", expiryTime);
    }

    function isTokenExpired() {
        const expiryTime = localStorage.getItem("tokenExpiryTime");
        return new Date().getTime() > expiryTime;
    }

    function refreshToken() {
        const refreshToken = localStorage.getItem("refreshToken");
        if (!refreshToken) {
            return;
        }

        var xhr = new XMLHttpRequest();
        xhr.open("POST", "http://localhost:8081/shop/api/v1/auth/refresh", true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                var response = JSON.parse(xhr.responseText);
                var accessToken = response.token.split(':')[0].trim();
                var newRefreshToken = response.token.split(':')[1].trim();
                localStorage.setItem("accessToken", accessToken);
                localStorage.setItem("refreshToken", newRefreshToken);
                setTokenExpiry(accessToken);
                console.log("Access Token refreshed:", accessToken);
            } else if (xhr.readyState === 4) {
                console.error("Token refresh failed. Status:", xhr.status);
                // Optionally, you can redirect the user to the login page or show a message
                // window.location.href = "login.html";
            }
        };
        var data = JSON.stringify({
            "refreshToken": refreshToken
        });
        xhr.send(data);
    }

    const accessToken = localStorage.getItem("accessToken");

    if (accessToken) {
        if (isTokenExpired()) {
            refreshToken();
        } else {
            // Redirect to the main page if the user is already logged in
            window.location.href = "index.html";
        }
    }

    document.getElementById("signUpBtn").addEventListener("click", function() {
        var name = document.getElementById("nameInput").value;
        var email = document.getElementById("emailInput").value;
        var password = document.getElementById("passwordInput").value;
        var role = document.getElementById("roleInput").value;

        var xhr = new XMLHttpRequest();
        xhr.open("POST", "http://localhost:8081/shop/api/v1/auth/signup", true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                var response = JSON.parse(xhr.responseText);
                var accessToken = response.token.split(':')[0].trim();
                var refreshToken = response.token.split(':')[1].trim();
                localStorage.setItem("accessToken", accessToken);
                localStorage.setItem("refreshToken", refreshToken);
                setTokenExpiry(accessToken);
                console.log("Access Token:", accessToken);
                console.log("Refresh Token:", refreshToken);
                // Redirect after signup if needed
                if (localStorage.getItem("accessToken")) {
                    window.location.href = "index.html";
                }
            }
        };
        var data = JSON.stringify({
            "name": name,
            "email": email,
            "password": password,
            "role": role
        });
        xhr.send(data);
    });

    document.getElementById("signInBtn").addEventListener("click", function() {
        refreshToken();
        var email = document.getElementById("emailLogin").value;
        var password = document.getElementById("passwordLogin").value;

        var xhr = new XMLHttpRequest();
        xhr.open("POST", "http://localhost:8081/shop/api/v1/auth/signin", true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    var accessToken = response.token.split(':')[0].trim();
                    var refreshToken = response.token.split(':')[1].trim();
                    localStorage.setItem("accessToken", accessToken);
                    localStorage.setItem("refreshToken", refreshToken);
                    setTokenExpiry(accessToken);
                    console.log("Access Token:", accessToken);
                    console.log("Refresh Token:", refreshToken);

                    // Redirect to another page if the access token is successfully stored
                    if (localStorage.getItem("accessToken")) {
                        window.location.href = "index.html";  // Change this to your desired page
                    }
                } else {
                    // Handle unsuccessful sign-in, e.g., display an error message
                    console.error("Sign In failed. Status:", xhr.status);
                }
            }
        };
        var data = JSON.stringify({
            "email": email,
            "password": password
        });
        xhr.send(data);
    });

    // Call refreshToken function periodically (e.g., every 15 minutes)
    const refreshTokenInterval = setInterval(function() {
        if (isTokenExpired()) {
            refreshToken();
        }
    }, 15 * 60 * 1000); // 15 minutes

    function logout() {
        // Clear tokens from local storage
        localStorage.removeItem("accessToken");
        localStorage.removeItem("refreshToken");
        localStorage.removeItem("tokenExpiryTime");

        // Clear the interval that refreshes the token
        clearInterval(refreshTokenInterval);

        // Redirect to the login page
        window.location.href = "login.html";
    }
</script>
</body>
</html>